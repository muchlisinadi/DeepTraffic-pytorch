import os

from torchvision import datasets


class Malware10ClassBase(datasets.MNIST):

    dict_classes = {
        "benign": [
            "BitTorrent",
            "Facetime",
            "FTP",
            "Gmail",
            "MySQL",
            "Outlook",
            "Skype",
            "SMB",
            "Weibo",
            "WorldOfWarcraft",
        ],
        "malware": [
            "Cridex",
            "Geodo",
            "Htbot",
            "Miuref",
            "Neris",
            "Nsis-ay",
            "Shifu",
            "Tinba",
            "Virut",
            "Zeus",
        ],
    }

    dict_resources = {"benign": [], "malware": []}

    def __init__(
        self,
        root,
        malware,
        train=True,
        transform=None,
        target_transform=None,
        download=False,
    ):

        if malware:
            self.classes = self.dict_classes["malware"]
            self.resources = self.dict_resources["malware"]
        else:
            self.classes = self.dict_classes["benign"]
            self.resources = self.dict_resources["benign"]

        self.type_data = "Malware" if malware else "Benign"
        self.mirrors = [m.format(type_data=self.type_data) for m in self.mirrors]

        super().__init__(
            root,
            train=train,
            transform=transform,
            target_transform=target_transform,
            download=download,
        )

    @property
    def raw_folder(self) -> str:
        return os.path.join(self.root, self.__class__.__name__, "raw", self.type_data)

    @property
    def processed_folder(self) -> str:
        return os.path.join(
            self.root, self.__class__.__name__, "processed", self.type_data
        )


class Malware10ClassSessionAllLayers(Malware10ClassBase):
    """`Malware-MNIST <https://github.com/echowei/DeepTraffict>`_ Dataset.

    Args:
        root (string): Root directory of dataset where ``Malware10ClassSessionAllLayers/raw/train-images-idx3-ubyte``
            and  ``Malware10ClassSessionAllLayers/raw/t10k-images-idx3-ubyte`` exist.
        train (bool, optional): If True, creates dataset from ``train-images-idx3-ubyte``,
            otherwise from ``t10k-images-idx3-ubyte``.
        download (bool, optional): If True, downloads the dataset from the internet and
            puts it in root directory. If dataset is already downloaded, it is not
            downloaded again.
        transform (callable, optional): A function/transform that  takes in an PIL image
            and returns a transformed version. E.g, ``transforms.RandomCrop``
        target_transform (callable, optional): A function/transform that takes in the
            target and transforms it.
    """

    mirrors = [
        "http://raw.githubusercontent.com/echowei/DeepTraffic/master/1.malware_traffic_classification/3.PreprocessedResults/10class/{type_data}/SessionAllLayers/"
    ]
    dict_resources = {
        "benign": [
            ("t10k-images-idx3-ubyte.gz", "70a66833d53a7952942d50f63fdc2c22"),
            ("t10k-labels-idx1-ubyte.gz", "44041305a41fc84cb966a1314cf9685d"),
            ("train-labels-idx1-ubyte.gz", "1a19be107a13801b311f7f5e057e2591"),
            ("train-images-idx3-ubyte.gz", "e510bb0dcabefce1b4d49927dfe6febc"),
        ],
        "malware": [
            ("t10k-images-idx3-ubyte.gz", "78e9dc42f29de3f967ec93c1434ebf90"),
            ("t10k-labels-idx1-ubyte.gz", "0b2e2b07e18f7a018152995a6559239f"),
            ("train-labels-idx1-ubyte.gz", "6ffc6fecbc21be6c824047168915302b"),
            ("train-images-idx3-ubyte.gz", "ab39473c726abf367e2f63b8d7cec709"),
        ],
    }


class Malware10ClassSessionL7(Malware10ClassBase):
    """`Malware-MNIST <https://github.com/echowei/DeepTraffict>`_ Dataset.

    Args:
        root (string): Root directory of dataset where ``Malware10ClassSessionL7/raw/train-images-idx3-ubyte``
            and  ``Malware10ClassSessionL7/raw/t10k-images-idx3-ubyte`` exist.
        train (bool, optional): If True, creates dataset from ``train-images-idx3-ubyte``,
            otherwise from ``t10k-images-idx3-ubyte``.
        download (bool, optional): If True, downloads the dataset from the internet and
            puts it in root directory. If dataset is already downloaded, it is not
            downloaded again.
        transform (callable, optional): A function/transform that  takes in an PIL image
            and returns a transformed version. E.g, ``transforms.RandomCrop``
        target_transform (callable, optional): A function/transform that takes in the
            target and transforms it.
    """

    mirrors = [
        "http://raw.githubusercontent.com/echowei/DeepTraffic/master/1.malware_traffic_classification/3.PreprocessedResults/10class/{type_data}/SessionL7/"
    ]
    dict_resources = {
        "benign": [
            ("t10k-images-idx3-ubyte.gz", "a09d6a3087fa1829e7cfb0c0e70d89e5"),
            ("t10k-labels-idx1-ubyte.gz", "88fb9af187316f6fd36b9ea0f879ae2f"),
            ("train-labels-idx1-ubyte.gz", "499ca69d676545bd13dcd04d9e03a201"),
            ("train-images-idx3-ubyte.gz", "369158259ed6c9ebad62562ba70841e9"),
        ],
        "malware": [
            ("t10k-images-idx3-ubyte.gz", "26580e21fc1b0a410a5aadcea9506f3d"),
            ("t10k-labels-idx1-ubyte.gz", "da2da263e8c841c7fdc577407f064560"),
            ("train-labels-idx1-ubyte.gz", "816e29e53e5377e92e557e9cff36d784"),
            ("train-images-idx3-ubyte.gz", "5d28126201fda366276e2a6313076ff9"),
        ],
    }


class Malware10ClassFlowAllLayers(Malware10ClassBase):
    """`Malware-MNIST <https://github.com/echowei/DeepTraffict>`_ Dataset.

    Args:
        root (string): Root directory of dataset where ``Malware10ClassFlowAllLayers/raw/train-images-idx3-ubyte``
            and  ``Malware10ClassFlowAllLayers/raw/t10k-images-idx3-ubyte`` exist.
        train (bool, optional): If True, creates dataset from ``train-images-idx3-ubyte``,
            otherwise from ``t10k-images-idx3-ubyte``.
        download (bool, optional): If True, downloads the dataset from the internet and
            puts it in root directory. If dataset is already downloaded, it is not
            downloaded again.
        transform (callable, optional): A function/transform that  takes in an PIL image
            and returns a transformed version. E.g, ``transforms.RandomCrop``
        target_transform (callable, optional): A function/transform that takes in the
            target and transforms it.
    """

    mirrors = [
        "http://raw.githubusercontent.com/echowei/DeepTraffic/master/1.malware_traffic_classification/3.PreprocessedResults/10class/{type_data}/FlowAllLayers/"
    ]
    dict_resources = {
        "benign": [
            ("t10k-images-idx3-ubyte.gz", "550d251b0423834a0e646b87fa3ab1e7"),
            ("t10k-labels-idx1-ubyte.gz", "f7892344824a21dbbb9a858369ef6ad0"),
            ("train-labels-idx1-ubyte.gz", "105bf2b4f87ef64236b8f268e1b0dfa2"),
            ("train-images-idx3-ubyte.gz", "f5cbd97a9c17f41b8129a4397713c196"),
        ],
        "malware": [
            ("t10k-images-idx3-ubyte.gz", "221249a60a751ff442b220ff8c317a89"),
            ("t10k-labels-idx1-ubyte.gz", "9a88b04db0b29f3598773ac4bc2ed711"),
            ("train-labels-idx1-ubyte.gz", "470d67edee78758d97a3c9294b9b3879"),
            ("train-images-idx3-ubyte.gz", "e5c77765d9645d8f7b0d486b578f9b2a"),
        ],
    }


class Malware10ClassFlowL7(Malware10ClassBase):
    """`Malware-MNIST <https://github.com/echowei/DeepTraffict>`_ Dataset.

    Args:
        root (string): Root directory of dataset where ``Malware10ClassFlowL7/raw/train-images-idx3-ubyte``
            and  ``Malware10ClassFlowL7/raw/t10k-images-idx3-ubyte`` exist.
        train (bool, optional): If True, creates dataset from ``train-images-idx3-ubyte``,
            otherwise from ``t10k-images-idx3-ubyte``.
        download (bool, optional): If True, downloads the dataset from the internet and
            puts it in root directory. If dataset is already downloaded, it is not
            downloaded again.
        transform (callable, optional): A function/transform that  takes in an PIL image
            and returns a transformed version. E.g, ``transforms.RandomCrop``
        target_transform (callable, optional): A function/transform that takes in the
            target and transforms it.
    """

    mirrors = [
        "http://raw.githubusercontent.com/echowei/DeepTraffic/master/1.malware_traffic_classification/3.PreprocessedResults/10class/{type_data}/FlowL7/"
    ]
    dict_resources = {
        "benign": [
            ("t10k-images-idx3-ubyte.gz", "de3c9fdde058093edc23471c17e286c1"),
            ("t10k-labels-idx1-ubyte.gz", "deb2621b3709f0909ecffb0399ce47a6"),
            ("train-labels-idx1-ubyte.gz", "36ac287c3f2dfafbd7a2495ade6ef466"),
            ("train-images-idx3-ubyte.gz", "7037a400a1acc304862dda104da26c24"),
        ],
        "malware": [
            ("t10k-images-idx3-ubyte.gz", "200ab627001cb84a9dca4a78f6de2e98"),
            ("t10k-labels-idx1-ubyte.gz", "b82bf08c916fa033dcf650979098c60c"),
            ("train-labels-idx1-ubyte.gz", "7e4c64aeb213607374b07d1e31850eb2"),
            ("train-images-idx3-ubyte.gz", "f37640f63b524fd7f535ea51378aa096"),
        ],
    }
